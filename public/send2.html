<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Envoyer un bon d'achat - Nimwema</title>
    <meta name="description" content="Envoyez un bon d'achat alimentaire via Nimwema">
    <meta http-equiv="Content-Security-Policy" content="default-src 'self'; script-src 'self' 'unsafe-inline'; style-src 'self' 'unsafe-inline';">
    <!-- Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600;700;800&display=swap" rel="stylesheet">
    <!-- Styles -->
    <link rel="stylesheet" href="/css/styles.css">
    <link rel="stylesheet" href="/css/forms.css">
    <link rel="stylesheet" href="/css/send.css">
    <link rel="stylesheet" href="/css/flexpay-popup.css">
</head>
<body>
    <!-- Header -->
    <header class="header">
        <!-- Top Bar: Language Selector + Login -->
        <div class="header-top">
            <div class="language-selector">
                <button class="lang-btn active" data-lang="fr">FR</button>
                <button class="lang-btn" data-lang="ln">LN</button>
                <button class="lang-btn" data-lang="en">EN</button>
            </div>
            <button class="login-btn" id="loginBtn">
                <span data-i18n="login">Connexion</span> / <span data-i18n="welcome">Bienvenue</span>
            </button>
        </div>
        <!-- Main Header: Logo + Menu -->
        <div class="header-main">
            <a href="/" class="logo">
                NIM<span class="w">W</span>EMA
            </a>
            <button class="hamburger" onclick="toggleMenu()">
                <span></span>
                <span></span>
                <span></span>
            </button>
        </div>
    </header>

    <!-- Main Content -->
    <main class="section">
        <div class="container container-narrow">
            <!-- Page Header -->
            <div class="page-header">
                <h1 data-i18n="send_voucher_title">Envoyer un bon d'achat</h1>
                <p class="text-small" data-i18n="send_voucher_subtitle">
                    Choisissez le montant et envoyez un bon d'achat √† vos proches
                </p>
            </div>

            <!-- Send Form -->
            <form id="sendVoucherForm" class="form-card" novalidate>
                <!-- Currency Selection -->
                <div class="form-section">
                    <h3 class="form-section-title" data-i18n="currency_selection">Devise</h3>
                    <div class="currency-selector-group">
                        <button type="button" class="currency-btn active" data-currency="USD" onclick="selectCurrency('USD')">
                            <span class="currency-symbol">$</span>
                            <span class="currency-name">USD</span>
                        </button>
                        <button type="button" class="currency-btn" data-currency="CDF" onclick="selectCurrency('CDF')">
                            <span class="currency-symbol">FC</span>
                            <span class="currency-name">CDF</span>
                        </button>
                    </div>
                    <div class="exchange-rate-display" id="exchangeRateDisplay">
                        <small data-i18n="exchange_rate">Taux de change:</small>
                        <strong id="exchangeRateText">1 USD = 2,800 CDF</strong>
                    </div>
                </div>

                <!-- Amount Selection -->
                <div class="form-section">
                    <h3 class="form-section-title" data-i18n="amount_selection">Montant</h3>
                    <div class="amount-preset-grid" id="amountPresetGrid">
                        <!-- Preset buttons generated by JS -->
                    </div>
                    <div class="form-group">
                        <label for="customAmount" class="form-label">
                            <span data-i18n="custom_amount">Montant personnalis√©</span>
                        </label>
                        <div class="amount-input-group">
                            <span class="amount-currency" id="amountCurrencySymbol">$</span>
                            <input type="number" id="customAmount" name="customAmount" class="form-input amount-input" min="1" step="1" placeholder="0" aria-describedby="amount-help">
                            <span class="amount-equivalent" id="amountEquivalent"></span>
                        </div>
                        <small id="amount-help" class="sr-only">Entrez un montant positif</small>
                    </div>
                </div>

                <!-- Quantity Selection -->
                <div class="form-section">
                    <h3 class="form-section-title" data-i18n="quantity_selection">Quantit√©</h3>
                    <div class="form-group">
                        <label for="quantity" class="form-label">
                            <span data-i18n="number_of_vouchers">Nombre de bons</span>
                            <span class="required" aria-hidden="true">*</span>
                        </label>
                        <input type="number" id="quantity" name="quantity" class="form-input" required min="1" max="50" value="1" onchange="updateTotalAmount()" aria-describedby="quantity-help">
                        <small id="quantity-help" class="sr-only">Maximum 50 bons</small>
                    </div>
                    <div class="total-amount-display">
                        <div class="total-label" data-i18n="total_amount">Montant total:</div>
                        <div class="total-value" id="totalAmountDisplay">$0</div>
                    </div>
                </div>

                <!-- Recipients Selection -->
                <div class="form-section">
                    <h3 class="form-section-title" data-i18n="recipients_selection">Destinataires</h3>
                    <div class="radio-group">
                        <label class="radio-label">
                            <input type="radio" name="recipientType" value="waiting_list" onchange="toggleRecipientFields()">
                            <span class="radio-custom"></span>
                            <span class="radio-text">
                                <strong data-i18n="from_waiting_list">Depuis la liste d'attente</strong>
                                <small data-i18n="from_waiting_list_desc">Choisir des demandes en attente</small>
                            </span>
                        </label>
                        <label class="radio-label">
                            <input type="radio" name="recipientType" value="specific" checked onchange="toggleRecipientFields()">
                            <span class="radio-custom"></span>
                            <span class="radio-text">
                                <strong data-i18n="specific_recipients">Destinataires sp√©cifiques</strong>
                                <small data-i18n="specific_recipients_desc">Entrer les num√©ros manuellement</small>
                            </span>
                        </label>
                    </div>
                </div>

                <!-- Waiting List Section (Hidden) -->
                <div id="waitingListSection" class="form-section hidden">
                    <h3 class="form-section-title" data-i18n="select_from_waiting_list">S√©lectionner depuis la liste d'attente</h3>
                    <div id="waitingListContainer" class="waiting-list-container">
                        <div class="loading-state">
                            <p data-i18n="loading">Chargement...</p>
                        </div>
                    </div>
                </div>

                <!-- Specific Recipients Section -->
                <div id="specificRecipientsSection" class="form-section">
                    <h3 class="form-section-title" data-i18n="enter_recipients">Entrer les destinataires</h3>
                    <div class="recipients-info-box">
                        <p data-i18n="recipients_info_text">Vous pouvez entrer jusqu'√† 50 num√©ros maximum par op√©ration.</p>
                        <span id="batchInfo" class="hidden">
                            <span data-i18n="batch_info_text">Vous devrez entrer</span> 
                            <strong id="batchCount">0</strong> 
                            <span data-i18n="batch_info_text2">lot(s) de num√©ros.</span>
                        </span>
                    </div>
                    <div id="recipientsInputContainer">
                        <!-- Generated -->
                    </div>
                    <button type="button" class="btn btn-secondary" onclick="addRecipientField()" id="addRecipientBtn">
                        ‚ûï <span data-i18n="add_recipient">Ajouter un destinataire</span>
                    </button>
                </div>

                <!-- Sender Options -->
                <div class="form-section">
                    <h3 class="form-section-title" data-i18n="sender_options">Options d'envoi</h3>
                    <div class="form-group">
                        <label for="senderName" class="form-label">
                            <span data-i18n="your_name">Votre nom</span>
                            <span class="required" aria-hidden="true">*</span>
                        </label>
                        <input type="text" id="senderName" name="senderName" class="form-input" required placeholder="Votre nom complet" aria-describedby="name-help">
                        <small id="name-help" class="sr-only">Nom complet requis</small>
                    </div>
                    <div class="form-group">
                        <label for="senderPhone" class="form-label">
                            <span>Votre T√©l√©phone (utilis√© pour Mobile Money)</span>
                            <span class="required" aria-hidden="true">*</span>
                        </label>
                        <input type="tel" id="senderPhone" name="senderPhone" class="form-input" placeholder="+243XXXXXXXXX" inputmode="tel" autocomplete="tel" required aria-describedby="phone-help">
                        <small id="phone-help">Format conseill√© : +243812345678 (E.164)</small>
                    </div>
                    <div class="form-group" id="accountFields" style="display: none;">
                        <label for="senderEmail" class="form-label">
                            <span data-i18n="your_email">Votre Email</span>
                            <span class="required" aria-hidden="true">*</span>
                        </label>
                        <input type="email" id="senderEmail" name="senderEmail" class="form-input" placeholder="votre@email.com" autocomplete="email" required aria-describedby="email-help">
                        <small id="email-help" class="sr-only">Email valide requis pour compte</small>
                    </div>
                    <div class="form-group" id="passwordFields" style="display: none;">
                        <label for="senderPassword" class="form-label">
                            <span data-i18n="your_password">Mot de passe</span>
                            <span class="required" aria-hidden="true">*</span>
                        </label>
                        <div class="password-toggle">
                            <input type="password" id="senderPassword" name="senderPassword" class="form-input" placeholder="Choisissez un mot de passe" autocomplete="new-password" required aria-describedby="pass-help">
                            <button type="button" class="password-toggle-btn" aria-label="Afficher le mot de passe">üëÅÔ∏è</button>
                            <small id="pass-help" class="sr-only">Minimum 8 caract√®res</small>
                        </div>
                        <p class="text-xs text-gray-500 mt-1">Ce mot de passe vous servira √† vous connecter plus tard</p>
                    </div>
                    <div class="checkbox-group">
                        <label class="checkbox-label">
                            <input type="checkbox" id="hideIdentity" name="hideIdentity">
                            <span class="checkbox-custom"></span>
                            <span data-i18n="hide_identity">Masquer mon identit√© (envoyer anonymement)</span>
                        </label>
                    </div>
                    <div class="form-group">
                        <label for="message" class="form-label">
                            <span data-i18n="message_optional">Message (optionnel)</span>
                        </label>
                        <textarea id="message" name="message" class="form-textarea" rows="3" maxlength="200" placeholder="Ajoutez un message personnel..." aria-describedby="msg-help"></textarea>
                        <small id="msg-help">0/200 caract√®res</small>
                    </div>
                </div>

                <!-- Fee Information -->
                <div class="form-section">
                    <h3 class="form-section-title" data-i18n="fees_payment">Frais et paiement</h3>
                    <div class="fee-breakdown">
                        <div class="fee-row">
                            <span data-i18n="subtotal">Sous-total:</span>
                            <span id="feeSubtotal">$0</span>
                        </div>
                        <div class="fee-row">
                            <span data-i18n="service_fee">Frais de service (3.5%):</span>
                            <span id="feeAmount">$0</span>
                        </div>
                        <div class="fee-row fee-total">
                            <span data-i18n="total_to_pay">Total √† payer:</span>
                            <span id="feeTotalAmount">$0</span>
                        </div>
                    </div>
                    <div class="checkbox-group">
                        <label class="checkbox-label">
                            <input type="checkbox" id="coverFees" name="coverFees" onchange="updateFees()">
                            <span class="checkbox-custom"></span>
                            <span data-i18n="cover_fees">Je prends en charge les frais (le destinataire recevra le montant complet)</span>
                        </label>
                    </div>
                </div>

                <!-- Payment Method Selection -->
                <div class="form-section">
                    <h3 class="form-section-title" data-i18n="payment_method">M√©thode de paiement</h3>
                    <div class="payment-methods-grid">
                        <label class="payment-method-card">
                            <input type="radio" name="paymentMethod" value="flexpay" checked onchange="toggleAccountFields()">
                            <span class="payment-method-content">
                                <span class="payment-method-icon">üì±</span>
                                <span class="payment-method-name">Mobile Money</span>
                                <span class="payment-method-desc">Via FlexPay</span>
                            </span>
                        </label>
                        <label class="payment-method-card">
                            <input type="radio" name="paymentMethod" value="flexpaycard" onchange="toggleAccountFields()">
                            <span class="payment-method-content">
                                <span class="payment-method-icon">üí≥</span>
                                <span class="payment-method-name">Carte bancaire</span>
                                <span class="payment-method-desc">Via FlexPay</span>
                            </span>
                        </label>
                        <label class="payment-method-card">
                            <input type="radio" name="paymentMethod" value="cash" onchange="toggleAccountFields()">
                            <span class="payment-method-content">
                                <span class="payment-method-icon">üíµ</span>
                                <span class="payment-method-name">Cash / Western Union</span>
                                <span class="payment-method-desc">Paiement manuel (pending)</span>
                            </span>
                        </label>
                        <label class="payment-method-card">
                            <input type="radio" name="paymentMethod" value="bank" onchange="toggleAccountFields()">
                            <span class="payment-method-content">
                                <span class="payment-method-icon">üè¶</span>
                                <span class="payment-method-name">Virement Bancaire</span>
                                <span class="payment-method-desc">Transfert bancaire (pending)</span>
                            </span>
                        </label>
                    </div>
                </div>

                <!-- Form Actions -->
                <div class="form-actions">
                    <button type="button" class="btn btn-secondary" onclick="window.history.back()">
                        <span data-i18n="cancel">Annuler</span>
                    </button>
                    <button type="submit" class="btn btn-primary btn-large" id="submitBtn">
                        <span data-i18n="proceed_to_payment">Proc√©der au paiement</span>
                    </button>
                </div>
            </form>
        </div>
    </main>

    <!-- Footer -->
    <footer class="footer">
        <div class="container">
            <div class="footer-bottom">
                <p>&copy; 2024 Nimwema. <span data-i18n="allrights">Tous droits r√©serv√©s.</span></p>
            </div>
        </div>
    </footer>

    <!-- Scripts -->
    <script src="/js/i18n.js"></script>
    <script src="/js/main.js"></script>
    <script src="/js/send-voucher.js"></script>
    <script>
        // Production-ready JS for send-voucher (modular, validated, session-aware)
        (function() {
            'use strict';

            // Elements
            const form = document.getElementById('sendVoucherForm');
            const loginBtn = document.getElementById('loginBtn');
            const submitBtn = document.getElementById('submitBtn');
            const amountPresetGrid = document.getElementById('amountPresetGrid');
            const customAmount = document.getElementById('customAmount');
            const quantity = document.getElementById('quantity');
            const totalAmountDisplay = document.getElementById('totalAmountDisplay');
            const amountCurrencySymbol = document.getElementById('amountCurrencySymbol');
            const amountEquivalent = document.getElementById('amountEquivalent');
            const exchangeRateText = document.getElementById('exchangeRateText');
            const feeSubtotal = document.getElementById('feeSubtotal');
            const feeAmount = document.getElementById('feeAmount');
            const feeTotalAmount = document.getElementById('feeTotalAmount');
            const coverFees = document.getElementById('coverFees');
            const recipientsInputContainer = document.getElementById('recipientsInputContainer');
            const addRecipientBtn = document.getElementById('addRecipientBtn');
            const batchInfo = document.getElementById('batchInfo');
            const batchCount = document.getElementById('batchCount');
            const message = document.getElementById('message');
            const messageCount = document.getElementById('msg-help');
            const accountFields = document.getElementById('accountFields');
            const passwordFields = document.getElementById('passwordFields');
            const waitingListSection = document.getElementById('waitingListSection');
            const specificRecipientsSection = document.getElementById('specificRecipientsSection');

            // State
            let currentCurrency = 'USD';
            let exchangeRate = 2800; // 1 USD = 2800 CDF (fetch dynamically if needed)
            let recipientFields = 1;
            let user = null; // From localStorage

            // Load user from localStorage
            function loadUser() {
                const userStr = localStorage.getItem('nimwema_user');
                if (userStr) {
                    try {
                        user = JSON.parse(userStr);
                        if (user.role === 'sender') {
                            document.getElementById('senderName').value = user.name || '';
                            document.getElementById('senderPhone').value = user.phone || '';
                            document.getElementById('senderEmail').value = user.email || '';
                            loginBtn.textContent = `Bonjour, ${user.name}`;
                            loginBtn.onclick = () => window.location.href = 'dashboard.html';
                        }
                    } catch (e) {
                        localStorage.removeItem('nimwema_user');
                    }
                }
            }

            // Currency selection
            function selectCurrency(currency) {
                currentCurrency = currency;
                document.querySelectorAll('.currency-btn').forEach(btn => btn.classList.remove('active'));
                event.target.classList.add('active');
                amountCurrencySymbol.textContent = currency === 'USD' ? '$' : 'FC';
                exchangeRateText.textContent = currency === 'USD' ? '1 USD = 2,800 CDF' : '1 CDF = 0.00036 USD';
                updateTotalAmount();
            }

            // Preset amounts
            function initPresets() {
                const presets = [10, 25, 50, 100, 200];
                amountPresetGrid.innerHTML = presets.map(amount => `
                    <button type="button" class="amount-preset" onclick="selectPreset(${amount})" data-amount="${amount}">${amount === 'USD' ? '$' : 'FC'}${amount}</button>
                `).join('');
            }

            function selectPreset(amount) {
                customAmount.value = amount;
                customAmount.dispatchEvent(new Event('input'));
                updateTotalAmount();
            }

            // Update total amount
            function updateTotalAmount() {
                const amount = parseFloat(customAmount.value) || 0;
                const qty = parseInt(quantity.value) || 1;
                const total = amount * qty;
                totalAmountDisplay.textContent = `${currentCurrency === 'USD' ? '$' : 'FC'}${total.toFixed(0)}`;
                updateFees();
            }

            // Update fees
            function updateFees() {
                const subtotal = parseFloat(totalAmountDisplay.textContent.replace(/[^0-9.]/g, '')) || 0;
                const feeRate = 0.035; // 3.5%
                const fee = subtotal * feeRate;
                const cover = coverFees.checked;
                feeSubtotal.textContent = `${currentCurrency === 'USD' ? '$' : 'FC'}${subtotal.toFixed(2)}`;
                feeAmount.textContent = `${currentCurrency === 'USD' ? '$' : 'FC'}${fee.toFixed(2)}`;
                feeTotalAmount.textContent = `${currentCurrency === 'USD' ? '$' : 'FC'}${(cover ? subtotal + fee : subtotal).toFixed(2)}`;
            }

            // Toggle recipient fields
            function toggleRecipientFields() {
                const type = document.querySelector('input[name="recipientType"]:checked').value;
                if (type === 'waiting_list') {
                    waitingListSection.classList.remove('hidden');
                    specificRecipientsSection.classList.add('hidden');
                    loadWaitingList(); // Stub - implement if needed
                } else {
                    waitingListSection.classList.add('hidden');
                    specificRecipientsSection.classList.remove('hidden');
                    updateBatchInfo();
                }
            }

            // Load waiting list (stub)
            function loadWaitingList() {
                // Fetch /api/waiting-list, populate checkboxes
                const container = document.getElementById('waitingListContainer');
                container.innerHTML = '<p>Aucune demande en attente.</p>'; // Placeholder
            }

            // Add recipient field
            function addRecipientField() {
                if (recipientFields >= 50) return;
                recipientFields++;
                const div = document.createElement('div');
                div.className = 'form-group recipient-field';
                div.innerHTML = `
                    <label for="recipient${recipientFields}" class="form-label">Num√©ro ${recipientFields} <span aria-hidden="true">*</span></label>
                    <input type="tel" id="recipient${recipientFields}" name="recipients[]" class="form-input" placeholder="+243XXXXXXXXX" inputmode="tel" required aria-describedby="recipient-help">
                    <small id="recipient-help" class="sr-only">Format E.164, unique</small>
                    <button type="button" class="btn btn-sm btn-danger" onclick="removeRecipientField(this)">Supprimer</button>
                `;
                recipientsInputContainer.appendChild(div);
                updateBatchInfo();
            }

            function removeRecipientField(btn) {
                btn.parentElement.remove();
                recipientFields--;
                updateBatchInfo();
            }

            function updateBatchInfo() {
                const count = document.querySelectorAll('.recipient-field').length;
                if (count > 0) {
                    batchInfo.classList.remove('hidden');
                    batchCount.textContent = Math.ceil(count / 10); // Assume 10 per batch
                } else {
                    batchInfo.classList.add('hidden');
                }
            }

            // Toggle account fields for cash/bank
            function toggleAccountFields() {
                const method = document.querySelector('input[name="paymentMethod"]:checked').value;
                const showAccount = method === 'cash' || method === 'bank';
                accountFields.style.display = showAccount ? 'block' : 'none';
                passwordFields.style.display = showAccount ? 'block' : 'none';
                document.getElementById('senderEmail').required = showAccount;
                document.getElementById('senderPassword').required = showAccount;
            }

            // Message counter
            message.addEventListener('input', () => {
                messageCount.textContent = `${message.value.length}/200`;
            });

            // Form validation
            function validateForm() {
                let isValid = true;
                const recipients = document.querySelectorAll('input[name="recipients[]"]');
                const phones = Array.from(recipients).map(input => input.value.trim()).filter(p => p);
                const uniquePhones = new Set(phones);
                if (phones.length !== uniquePhones.size) {
                    showError('Les num√©ros de t√©l√©phone doivent √™tre uniques.');
                    isValid = false;
                }
                if (phones.length > 50) {
                    showError('Maximum 50 destinataires.');
                    isValid = false;
                }
                if (phones.some(phone => !/^\+?\d{10,15}$/.test(phone.replace(/\D/g, '')))) {
                    showError('Format t√©l√©phone invalide (E.164 recommand√©).');
                    isValid = false;
                }
                // Add more validations (e.g., amount > 0, quantity <= 50)
                if (parseFloat(customAmount.value) <= 0) {
                    showError('Montant doit √™tre positif.');
                    isValid = false;
                }
                return isValid;
            }

            function showError(message) {
                // Show error banner (add div if needed)
                let errorDiv = document.getElementById('formError');
                if (!errorDiv) {
                    errorDiv = document.createElement('div');
                    errorDiv.id = 'formError';
                    errorDiv.className = 'error-message';
                    form.insertBefore(errorDiv, form.firstChild);
                }
                errorDiv.textContent = message;
                errorDiv.style.display = 'block';
                setTimeout(() => errorDiv.style.display = 'none', 5000);
            }

            // Submit handler (debounced)
            let submitTimeout;
            form.addEventListener('submit', async (e) => {
                e.preventDefault();
                if (submitTimeout) clearTimeout(submitTimeout);
                submitTimeout = setTimeout(async () => {
                    if (!validateForm()) return;

                    const formData = new FormData(form);
                    const data = Object.fromEntries(formData);
                    data.recipients = Array.from(document.querySelectorAll('input[name="recipients[]"]')).map(input => input.value.trim()).filter(p => p);
                    data.amount = parseFloat(customAmount.value);
                    data.quantity = parseInt(quantity.value);
                    data.total = parseFloat(totalAmountDisplay.textContent.replace(/[^0-9.]/g, ''));
                    data.currency = currentCurrency;
                    data.coverFees = coverFees.checked;
                    data.hideIdentity = document.getElementById('hideIdentity').checked;
                    data.message = message.value.trim();

                    submitBtn.disabled = true;
                    submitBtn.textContent = 'Envoi en cours...';

                    try {
                        const response = await fetch('/api/orders/create', {
                            method: 'POST',
                            headers: { 'Content-Type': 'application/json' },
                            credentials: 'include', // For session cookie
                            body: JSON.stringify(data)
                        });

                        if (!response.ok) {
                            const errorData = await response.json().catch(() => ({ message: 'Erreur serveur' }));
                            throw new Error(errorData.message || 'Erreur lors de la cr√©ation de la commande');
                        }

                        const result = await response.json();

                        if (result.success) {
                            // Store user if created
                            if (result.user) {
                                localStorage.setItem('nimwema_user', JSON.stringify({
                                    id: result.user.id,
                                    email: result.user.email,
                                    role: 'sender',
                                    name: result.user.name,
                                    phone: data.senderPhone
                                }));
                            }

                            // Show success and redirect
                            alert(`Commande cr√©√©e (ID: ${result.orderId}). Pour cash/bank, attendez l'approbation admin.`);
                            window.location.href = 'dashboard.html'; // User dashboard to see pending
                        } else {
                            throw new Error(result.message || '√âchec cr√©ation commande');
                        }
                    } catch (error) {
                        console.error('Order creation error:', error);
                        showError(error.message);
                    } finally {
                        submitBtn.disabled = false;
                        submitBtn.textContent = 'Proc√©der au paiement';
                    }
                }, 500); // Debounce
            });

            // Init
            document.addEventListener('DOMContentLoaded', () => {
                loadUser();
                initPresets();
                customAmount.addEventListener('input', updateTotalAmount);
                quantity.addEventListener('input', updateTotalAmount);
                coverFees.addEventListener('change', updateFees);
                message.addEventListener('input', () => messageCount.textContent = `${message.value.length}/200`);
                addRecipientField(); // Initial field
                toggleAccountFields(); // Initial state
                toggleRecipientFields(); // Initial state

                // Login button
                loginBtn.addEventListener('click', () => window.location.href = '/login.html');
            });
        })();
    </script>
</body>
</html>