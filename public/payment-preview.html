<!DOCTYPE html> <html lang="fr"> <head> <meta charset="UTF-8"> <meta name="viewport" content="width=device-width, initial-scale=1.0"> <title>Pr√©visualisation du Paiement - Test Nimwema</title> <link href="https://fonts.googleapis.com/css2?family=JetBrains+Mono:wght@400;500;600&family=Plus+Jakarta+Sans:wght@400;500;600;700&display=swap" rel="stylesheet"> <style> :root{--bg-primary:#0a0f1a;--bg-secondary:#111827;--bg-card:#1a2234;--bg-elevated:#243049;--text-primary:#f1f5f9;--text-secondary:#94a3b8;--text-muted:#64748b;--accent-green:#22c55e;--accent-green-dim:rgba(34,197,94,0.15);--accent-blue:#3b82f6;--accent-blue-dim:rgba(59,130,246,0.15);--accent-orange:#f97316;--accent-orange-dim:rgba(249,115,22,0.15);--accent-purple:#a855f7;--accent-purple-dim:rgba(168,85,247,0.15);--border-color:rgba(255,255,255,0.08);--border-highlight:rgba(255,255,255,0.15);--radius:12px;--radius-sm:8px} *{margin:0;padding:0;box-sizing:border-box} body{font-family:'Plus Jakarta Sans',sans-serif;background:var(--bg-primary);color:var(--text-primary);line-height:1.6;min-height:100vh} .container{max-width:1400px;margin:0 auto;padding:24px} .header{display:flex;justify-content:space-between;align-items:center;padding:20px 0;border-bottom:1px solid var(--border-color);margin-bottom:32px} .logo{font-size:24px;font-weight:700}.logo span{color:var(--accent-green)} .test-badge{background:var(--accent-orange-dim);color:var(--accent-orange);padding:6px 14px;border-radius:100px;font-size:13px;font-weight:600} .summary-grid{display:grid;grid-template-columns:repeat(auto-fit,minmax(250px,1fr));gap:20px;margin-bottom:40px} .summary-card{background:var(--bg-card);border:1px solid var(--border-color);border-radius:var(--radius);padding:20px} .summary-card h3{font-size:12px;text-transform:uppercase;letter-spacing:1px;color:var(--text-muted);margin-bottom:8px} .summary-value{font-size:26px;font-weight:700}.summary-value.currency{color:var(--accent-green)}.summary-value.quantity{color:var(--accent-blue)}.summary-value.method{color:var(--accent-purple)} .summary-sub{font-size:14px;color:var(--text-secondary);margin-top:4px} .main-content{display:grid;grid-template-columns:1fr 360px;gap:32px} @media(max-width:1024px){.main-content{grid-template-columns:1fr}} .process-section{background:var(--bg-card);border:1px solid var(--border-color);border-radius:var(--radius);overflow:hidden} .section-header{background:var(--bg-elevated);padding:20px 24px;border-bottom:1px solid var(--border-color);display:flex;align-items:center;gap:12px} .section-header h2{font-size:18px;font-weight:600} .section-icon{width:36px;height:36px;background:var(--accent-green-dim);border-radius:var(--radius-sm);display:flex;align-items:center;justify-content:center;font-size:18px} .step{border-bottom:1px solid var(--border-color);padding:24px}.step:last-child{border-bottom:none} .step-header{display:flex;align-items:flex-start;gap:16px;margin-bottom:16px} .step-number{width:32px;height:32px;background:linear-gradient(135deg,var(--accent-blue),var(--accent-purple));border-radius:50%;display:flex;align-items:center;justify-content:center;font-size:14px;font-weight:700;flex-shrink:0} .step-title{font-size:16px;font-weight:600;margin-bottom:4px}.step-subtitle{font-size:13px;color:var(--text-secondary)} .step-details{margin-left:48px} .data-table{background:var(--bg-secondary);border-radius:var(--radius-sm);overflow:hidden;margin-top:12px} .data-row{display:grid;grid-template-columns:150px 1fr;border-bottom:1px solid var(--border-color);font-size:13px}.data-row:last-child{border-bottom:none} .data-label{padding:10px 14px;background:var(--bg-elevated);color:var(--text-secondary);font-weight:500;font-family:'JetBrains Mono',monospace;font-size:11px} .data-value{padding:10px 14px;font-family:'JetBrains Mono',monospace;font-size:11px;word-break:break-all} .data-value.highlight{color:var(--accent-green)}.data-value.blue{color:var(--accent-blue)}.data-value.orange{color:var(--accent-orange)}.data-value.purple{color:var(--accent-purple)} .api-box{background:var(--bg-secondary);border-radius:var(--radius-sm);margin-top:16px;overflow:hidden} .api-header{display:flex;align-items:center;gap:10px;padding:12px 16px;background:var(--bg-elevated);border-bottom:1px solid var(--border-color)} .api-method{font-family:'JetBrains Mono',monospace;font-size:11px;font-weight:600;padding:4px 8px;border-radius:4px} .api-method.post{background:var(--accent-green-dim);color:var(--accent-green)}.api-method.get{background:var(--accent-blue-dim);color:var(--accent-blue)} .api-url{font-family:'JetBrains Mono',monospace;font-size:12px;color:var(--text-secondary)} .api-body{padding:16px}.api-body pre{font-family:'JetBrains Mono',monospace;font-size:11px;line-height:1.6;color:var(--text-secondary);white-space:pre-wrap;word-break:break-word} .key{color:var(--accent-purple)}.string{color:var(--accent-green)}.number{color:var(--accent-orange)}.boolean{color:var(--accent-blue)} .sms-preview{background:linear-gradient(135deg,#1e3a5f,#0f2744);border-radius:var(--radius-sm);padding:20px;margin-top:16px;position:relative} .sms-preview::before{content:'üì±';position:absolute;top:12px;right:12px;font-size:20px;opacity:0.5} .sms-label{font-size:11px;text-transform:uppercase;letter-spacing:1px;color:var(--text-muted);margin-bottom:8px} .sms-to{font-family:'JetBrains Mono',monospace;font-size:13px;color:var(--accent-green);margin-bottom:12px} .sms-content{font-size:14px;line-height:1.7;background:rgba(255,255,255,0.05);padding:16px;border-radius:var(--radius-sm);border-left:3px solid var(--accent-green)} .sidebar{display:flex;flex-direction:column;gap:24px} .sidebar-card{background:var(--bg-card);border:1px solid var(--border-color);border-radius:var(--radius);padding:24px} .sidebar-card h3{font-size:16px;font-weight:600;margin-bottom:20px;display:flex;align-items:center;gap:10px} .recipient-item{display:flex;align-items:center;gap:12px;padding:12px;background:var(--bg-secondary);border-radius:var(--radius-sm);margin-bottom:10px} .recipient-avatar{width:40px;height:40px;background:linear-gradient(135deg,var(--accent-blue),var(--accent-purple));border-radius:50%;display:flex;align-items:center;justify-content:center;font-size:16px;font-weight:600} .recipient-info{flex:1}.recipient-name{font-size:14px;font-weight:500}.recipient-phone{font-size:12px;color:var(--text-secondary);font-family:'JetBrains Mono',monospace} .fee-row{display:flex;justify-content:space-between;padding:12px 0;border-bottom:1px solid var(--border-color)}.fee-row:last-child{border-bottom:none} .fee-label{color:var(--text-secondary);font-size:14px}.fee-value{font-weight:600;font-family:'JetBrains Mono',monospace} .fee-row.total{background:var(--accent-green-dim);margin:16px -24px -24px;padding:16px 24px;border-radius:0 0 var(--radius) var(--radius)} .fee-row.total .fee-label,.fee-row.total .fee-value{color:var(--accent-green);font-weight:700} .calc-box{background:var(--bg-secondary);border-radius:var(--radius-sm);padding:16px;margin-top:16px;font-family:'JetBrains Mono',monospace;font-size:12px} .calc-line{display:flex;justify-content:space-between;margin-bottom:8px;color:var(--text-secondary)} .calc-line.result{border-top:1px dashed var(--border-highlight);padding-top:8px;margin-top:8px;color:var(--accent-green);font-weight:600} .storage-info{background:var(--accent-purple-dim);border:1px solid rgba(168,85,247,0.3);border-radius:var(--radius-sm);padding:16px;margin-bottom:12px} .storage-info h4{font-size:13px;color:var(--accent-purple);margin-bottom:8px} .storage-item{font-family:'JetBrains Mono',monospace;font-size:11px;color:var(--text-secondary)} .action-buttons{display:grid;grid-template-columns:1fr 1fr;gap:16px;margin-top:32px;padding-top:32px;border-top:1px solid var(--border-color)} .btn{padding:16px 24px;border-radius:var(--radius);font-size:15px;font-weight:600;cursor:pointer;transition:all 0.2s;border:none;display:flex;align-items:center;justify-content:center;gap:10px} .btn-cancel{background:var(--bg-elevated);color:var(--text-secondary);border:1px solid var(--border-color)} .btn-cancel:hover{background:var(--bg-card);color:var(--text-primary)} .btn-proceed{background:linear-gradient(135deg,var(--accent-green),#16a34a);color:white;box-shadow:0 4px 20px rgba(34,197,94,0.3)} .btn-proceed:hover{transform:translateY(-2px);box-shadow:0 6px 28px rgba(34,197,94,0.4)} .warning-box{background:var(--accent-orange-dim);border:1px solid rgba(249,115,22,0.3);border-radius:var(--radius-sm);padding:16px;margin-top:16px;display:flex;gap:12px} .warning-box .icon{font-size:20px}.warning-box .content{font-size:13px;color:var(--accent-orange)} .waiting-list-badge{background:var(--accent-orange-dim);color:var(--accent-orange);padding:4px 10px;border-radius:100px;font-size:11px;font-weight:600;margin-left:8px} .empty-state{text-align:center;padding:40px;color:var(--text-muted)}.empty-state-icon{font-size:48px;margin-bottom:16px;opacity:0.5} </style> </head> <body> <div class="container"> <header class="header"> <div class="logo">NIM<span>W</span>EMA</div> <div class="test-badge">üß™ MODE TEST - Pr√©visualisation</div> </header> <div class="summary-grid"> <div class="summary-card"><h3>Montant par bon</h3><div class="summary-value currency" id="summaryAmount">$0</div><div class="summary-sub" id="summaryAmountEquiv">‚âà 0 FC</div></div> <div class="summary-card"><h3>Quantit√©</h3><div class="summary-value quantity" id="summaryQuantity">0</div><div class="summary-sub">bon(s) d'achat</div></div> <div class="summary-card"><h3>M√©thode de paiement</h3><div class="summary-value method" id="summaryPaymentMethod">-</div><div class="summary-sub" id="summaryPaymentDesc">-</div></div> <div class="summary-card"><h3>Total √† payer</h3><div class="summary-value currency" id="summaryTotal">$0</div><div class="summary-sub" id="summaryTotalEquiv">‚âà 0 FC</div></div> </div> <div class="main-content"> <div class="process-section"> <div class="section-header"><div class="section-icon">üìã</div><h2>√âtapes du processus</h2></div> <div class="step"><div class="step-header"><div class="step-number">1</div><div><div class="step-title">Cr√©ation de la commande</div><div class="step-subtitle">POST /api/vouchers/create-pending</div></div></div><div class="step-details"><p style="color:var(--text-secondary);font-size:14px;margin-bottom:16px">Insertion dans les tables orders et order_recipients</p><h4 style="font-size:13px;color:var(--text-muted);margin-bottom:10px">üìä TABLE: orders</h4><div class="data-table" id="ordersTable"></div><h4 style="font-size:13px;color:var(--text-muted);margin:20px 0 10px">üìä TABLE: order_recipients</h4><div class="data-table" id="orderRecipientsTable"></div><div class="api-box"><div class="api-header"><span class="api-method post">POST</span><span class="api-url">/api/vouchers/create-pending</span></div><div class="api-body"><pre id="createPendingPayload"></pre></div></div></div></div> <div class="step"><div class="step-header"><div class="step-number">2</div><div><div class="step-title" id="step2Title">Initialisation du paiement</div><div class="step-subtitle" id="step2Subtitle">-</div></div></div><div class="step-details" id="step2Details"></div></div> <div class="step"><div class="step-header"><div class="step-number">3</div><div><div class="step-title">Cr√©ation des bons d'achat</div><div class="step-subtitle">POST /api/vouchers/create</div></div></div><div class="step-details"><p style="color:var(--text-secondary);font-size:14px;margin-bottom:16px">Apr√®s paiement confirm√©, g√©n√©ration des vouchers</p><h4 style="font-size:13px;color:var(--text-muted);margin-bottom:10px">üìä TABLE: vouchers</h4><div class="data-table" id="vouchersTable"></div><div id="waitingListUpdate" style="display:none"><h4 style="font-size:13px;color:var(--text-muted);margin:20px 0 10px">üìä UPDATE: requests</h4><div class="data-table"><div class="data-row"><div class="data-label">status</div><div class="data-value orange">'pending' ‚Üí 'fulfilled'</div></div></div></div></div></div> <div class="step"><div class="step-header"><div class="step-number">4</div><div><div class="step-title">Envoi des SMS</div><div class="step-subtitle">Notifications aux destinataires</div></div></div><div class="step-details" id="smsDetails"></div></div> <div class="step"><div class="step-header"><div class="step-number">5</div><div><div class="step-title">Mise √† jour commande</div><div class="step-subtitle">Finalisation</div></div></div><div class="step-details"><div class="data-table"><div class="data-row"><div class="data-label">status</div><div class="data-value highlight">'pending' ‚Üí 'paid'</div></div><div class="data-row"><div class="data-label">payment_status</div><div class="data-value highlight">'pending_payment' ‚Üí 'completed'</div></div></div></div></div> <div class="step"><div class="step-header"><div class="step-number">6</div><div><div class="step-title">Redirection</div><div class="step-subtitle" id="redirectUrl">/payment-success.html</div></div></div></div> </div> <div class="sidebar"> <div class="sidebar-card"><h3>üë• Destinataires <span id="recipientCount" style="color:var(--accent-blue)">(0)</span></h3><div id="recipientsList"></div></div> <div class="sidebar-card"><h3>üí∞ D√©tail des montants</h3><div class="fee-row"><span class="fee-label">Montant unitaire</span><span class="fee-value" id="feeAmount">$0</span></div><div class="fee-row"><span class="fee-label">√ó Quantit√©</span><span class="fee-value" id="feeQty">1</span></div><div class="fee-row"><span class="fee-label">Sous-total</span><span class="fee-value" id="feeSubtotal">$0</span></div><div class="fee-row"><span class="fee-label">Frais (3.5%)</span><span class="fee-value" id="feeFee">$0</span></div><div class="fee-row" id="feeCoverRow" style="display:none"><span class="fee-label">Frais pris en charge</span><span class="fee-value" style="color:var(--accent-green)">‚úì OUI</span></div><div class="fee-row total"><span class="fee-label">TOTAL</span><span class="fee-value" id="feeTotal">$0</span></div><div class="calc-box"><div class="calc-line"><span>Sous-total:</span><span id="calcSubtotal">0</span></div><div class="calc-line" id="calcFeeRow"><span>+ Frais:</span><span id="calcFee">0</span></div><div class="calc-line result"><span>= Total:</span><span id="calcTotal">0</span></div></div></div> <div class="sidebar-card"><h3>üíæ Stockage</h3><div class="storage-info"><h4>üç™ sessionStorage</h4><div class="storage-item">pendingOrder = {...}</div></div><div class="storage-info"><h4>üåê global.orders</h4><div class="storage-item">global.orders[orderId]</div></div></div> <div class="sidebar-card"><h3>üë§ Exp√©diteur</h3><div class="data-table"><div class="data-row"><div class="data-label">Nom</div><div class="data-value" id="senderName">-</div></div><div class="data-row"><div class="data-label">T√©l√©phone</div><div class="data-value" id="senderPhone">-</div></div><div class="data-row"><div class="data-label">Anonyme</div><div class="data-value" id="hideIdentity">Non</div></div></div></div> </div> </div> <div class="action-buttons"> <button class="btn btn-cancel" onclick="cancelAndReturn()">‚ùå Annuler et retourner</button> <button class="btn btn-proceed" onclick="proceedWithPayment()">‚úÖ Continuer le paiement</button> </div> </div> <script> const FEE_PERCENTAGE=3.5,DEFAULT_EXCHANGE_RATE=2800;let exchangeRate=DEFAULT_EXCHANGE_RATE,formData=null; document.addEventListener('DOMContentLoaded',function(){loadFormData();formData?renderPreview():showNoData()}); function loadFormData(){const s=sessionStorage.getItem('paymentPreviewData');if(s){try{formData=JSON.parse(s);return}catch(e){}}const p=new URLSearchParams(location.search).get('data');if(p){try{formData=JSON.parse(decodeURIComponent(p));return}catch(e){}}formData={amount:50,currency:'USD',quantity:1,senderName:'Jean Dupont',senderPhone:'+243812345678',hideIdentity:false,message:'Bon app√©tit!',coverFees:false,paymentMethod:'flexpay',recipientType:'specific',recipients:[{phone:'+243823456789',name:'Marie Kabila'}]}} function showNoData(){document.querySelector('.main-content').innerHTML='<div class="empty-state" style="grid-column:1/-1"><div class="empty-state-icon">‚ö†Ô∏è</div><h3>Aucune donn√©e</h3><p style="margin:16px 0">Acc√©dez depuis send.html</p><a href="send.html" class="btn btn-proceed" style="display:inline-flex;text-decoration:none">Retour</a></div>'} function renderPreview(){const d=formData,qty=d.quantity||1,amt=parseFloat(d.amount)||0,sub=amt*qty,fee=sub*(FEE_PERCENTAGE/100),tot=d.coverFees?sub+fee:sub; const fmt=(a,c=d.currency)=>c==='USD'?'$'+a.toFixed(2):Math.round(a).toLocaleString()+' FC'; const toCDF=u=>Math.ceil(u*exchangeRate/1000)*1000; document.getElementById('summaryAmount').textContent=fmt(amt); document.getElementById('summaryAmountEquiv').textContent=d.currency==='USD'?'‚âà '+toCDF(amt).toLocaleString()+' FC':'‚âà $'+(amt/exchangeRate).toFixed(2); document.getElementById('summaryQuantity').textContent=qty; document.getElementById('summaryTotal').textContent=fmt(tot); document.getElementById('summaryTotalEquiv').textContent=d.currency==='USD'?'‚âà '+toCDF(tot).toLocaleString()+' FC':'‚âà $'+(tot/exchangeRate).toFixed(2); const mN={flexpay:'Mobile Money',flexpaycard:'Carte Bancaire',cash:'Cash/WU',bank:'Virement'}; const mD={flexpay:'Via FlexPay',flexpaycard:'Via FlexPay',cash:'Paiement manuel',bank:'Transfert bancaire'}; document.getElementById('summaryPaymentMethod').textContent=mN[d.paymentMethod]||d.paymentMethod; document.getElementById('summaryPaymentDesc').textContent=mD[d.paymentMethod]||''; const orderId='O'+Date.now()+Math.random().toString(36).slice(2,6); document.getElementById('ordersTable').innerHTML=dataTable([['id',orderId,'purple'],['sender_name',d.senderName||'NULL'],['sender_phone',d.senderPhone],['amount',amt.toFixed(2),'highlight'],['currency',d.currency],['quantity',qty,'blue'],['payment_method',d.paymentMethod],['cover_fees',d.coverFees?'TRUE':'FALSE',d.coverFees?'highlight':''],['recipient_type',d.recipientType],['status','pending','orange'],['total_amount',tot.toFixed(2),'highlight']]); let recHtml=d.recipients.map((r,i)=>'<div class="data-row"><div class="data-label">Recipient '+(i+1)+'</div><div class="data-value"><span class="blue">'+r.phone+'</span> | '+(r.name||'Anonyme')+(r.requestId?'<span class="waiting-list-badge">Liste attente</span>':'')+'</div></div>').join(''); document.getElementById('orderRecipientsTable').innerHTML='<div class="data-row"><div class="data-label">order_id</div><div class="data-value purple">'+orderId+'</div></div>'+recHtml; const payload={currency:d.currency,amount:amt,quantity:qty,recipientType:d.recipientType,senderName:d.senderName,senderPhone:d.senderPhone,message:d.message||'',coverFees:d.coverFees,paymentMethod:d.paymentMethod,recipients:d.recipients}; document.getElementById('createPendingPayload').innerHTML=highlight(JSON.stringify(payload,null,2)); renderPaymentStep(d,orderId,tot); const vCode=genCode(),expDate=new Date(Date.now()+90*24*60*60*1000).toISOString().split('T')[0]; document.getElementById('vouchersTable').innerHTML=dataTable([['id','uuid_generate_v4()'],['code',vCode,'highlight'],['order_id',orderId,'purple'],['amount',amt.toFixed(2),'highlight'],['currency',d.currency],['recipient_phone',d.recipients[0]?.phone||'','blue'],['sender_name',d.hideIdentity?'Anonyme':(d.senderName||'Anonyme')],['status','active','highlight'],['expires_at',expDate]]); if(d.recipientType==='waiting_list')document.getElementById('waitingListUpdate').style.display='block'; renderSMS(d,amt);renderRecipients(d.recipients); document.getElementById('feeAmount').textContent=fmt(amt); document.getElementById('feeQty').textContent=qty; document.getElementById('feeSubtotal').textContent=fmt(sub); document.getElementById('feeFee').textContent=fmt(fee); document.getElementById('feeTotal').textContent=fmt(tot); if(d.coverFees)document.getElementById('feeCoverRow').style.display='flex'; document.getElementById('calcSubtotal').textContent=fmt(sub); document.getElementById('calcFee').textContent=fmt(d.coverFees?fee:0); document.getElementById('calcTotal').textContent=fmt(tot); if(!d.coverFees)document.getElementById('calcFeeRow').innerHTML='<span>Frais (d√©duit):</span><span style="color:var(--accent-orange)">-'+fmt(fee)+'</span>'; document.getElementById('senderName').textContent=d.senderName||'-'; document.getElementById('senderPhone').textContent=d.senderPhone||'-'; document.getElementById('hideIdentity').textContent=d.hideIdentity?'Oui':'Non'; document.getElementById('hideIdentity').style.color=d.hideIdentity?'var(--accent-orange)':'var(--text-secondary)'} function renderPaymentStep(d,orderId,tot){const det=document.getElementById('step2Details'),title=document.getElementById('step2Title'),sub=document.getElementById('step2Subtitle'),totCDF=Math.ceil(tot*exchangeRate); if(d.paymentMethod==='flexpay'){title.textContent='Paiement Mobile Money';sub.textContent='POST /api/payment/flexpay/initiate';det.innerHTML='<p style="color:var(--text-secondary);font-size:14px;margin-bottom:16px">Initialisation FlexPay Mobile Money</p><div class="api-box"><div class="api-header"><span class="api-method post">POST</span><span class="api-url">/api/payment/flexpay/initiate</span></div><div class="api-body"><pre>'+highlight(JSON.stringify({orderId:orderId,amount:totCDF,currency:'CDF',phone:d.senderPhone},null,2))+'</pre></div></div><div class="warning-box"><div class="icon">üì±</div><div class="content"><strong>MSISDN:</strong> '+formatMSISDN(d.senderPhone)+'<br>Montant: <strong>'+totCDF.toLocaleString()+' FC</strong></div></div><h4 style="font-size:13px;color:var(--text-muted);margin:20px 0 10px">üîÑ Polling</h4><div class="api-box"><div class="api-header"><span class="api-method get">GET</span><span class="api-url">/api/payment/flexpay/check/{orderNumber}</span></div><div class="api-body"><p style="font-size:12px;color:var(--text-secondary)">V√©rifie toutes les 4.5s. Status 0=Succ√®s, 1=√âchec</p></div></div>'} else if(d.paymentMethod==='flexpaycard'){title.textContent='Paiement Carte Bancaire';sub.textContent='POST /api/payment/flexpay/initiate-card';det.innerHTML='<p style="color:var(--text-secondary);font-size:14px;margin-bottom:16px">Redirection vers page s√©curis√©e FlexPay</p><div class="api-box"><div class="api-header"><span class="api-method post">POST</span><span class="api-url">/api/payment/flexpay/initiate-card</span></div><div class="api-body"><pre>'+highlight(JSON.stringify({orderId:orderId,amount:tot,currency:d.currency},null,2))+'</pre></div></div><div class="warning-box"><div class="icon">üîó</div><div class="content">Redirection vers <strong>cardpayment.flexpay.cd</strong></div></div>'} else{const label=d.paymentMethod==='cash'?'Cash/Western Union':'Virement Bancaire';title.textContent='Paiement Manuel ('+label+')';sub.textContent='Redirection /payment-instructions.html';det.innerHTML='<p style="color:var(--text-secondary);font-size:14px;margin-bottom:16px">Instructions de paiement affich√©es. Attente approbation admin.</p><div class="storage-info"><h4>üç™ sessionStorage.pendingOrder</h4><pre style="font-size:11px;color:var(--text-secondary);margin-top:8px">'+highlight(JSON.stringify({id:orderId,amount:parseFloat(d.amount),total:tot,paymentMethod:d.paymentMethod},null,2))+'</pre></div><div class="warning-box"><div class="icon">‚è≥</div><div class="content">N√©cessite <strong>approbation admin</strong></div></div>'}} function renderSMS(d,amt){const det=document.getElementById('smsDetails'),sender=d.hideIdentity?'Anonyme':(d.senderName||'Anonyme'),amtTxt=d.currency==='USD'?amt+' USD':Math.round(amt).toLocaleString()+' FC',exp=new Date(Date.now()+90*24*60*60*1000).toLocaleDateString('fr-FR'); let html='';d.recipients.forEach((r,i)=>{const code=genCode();html+='<div class="sms-preview"><div class="sms-label">SMS '+(i+1)+' - Destinataire</div><div class="sms-to">üì§ √Ä: '+r.phone+'</div><div class="sms-content">üéÅ Nimwema: '+sender+' vous envoie un bon de <strong>'+amtTxt+'</strong>!<br><br>üìå Code: <strong>'+code+'</strong><br><br>'+(d.message?'üí¨ "'+d.message+'"<br><br>':'')+'üìÖ Valide jusqu\'au: '+exp+'</div></div>'}); html+='<div class="sms-preview" style="background:linear-gradient(135deg,#1a3d5f,#0f2a44)"><div class="sms-label">SMS Confirmation - Exp√©diteur</div><div class="sms-to">üì§ √Ä: '+d.senderPhone+'</div><div class="sms-content">‚úÖ Nimwema: Paiement de <strong>'+amtTxt+'</strong> confirm√©!<br><br>üì¶ '+d.quantity+' bon(s) envoy√©(s).</div></div>'; det.innerHTML=html} function renderRecipients(recipients){const c=document.getElementById('recipientsList'),n=document.getElementById('recipientCount');n.textContent='('+recipients.length+')';if(!recipients.length)return;c.innerHTML=recipients.map(r=>'<div class="recipient-item"><div class="recipient-avatar">'+(r.name||'A')[0].toUpperCase()+'</div><div class="recipient-info"><div class="recipient-name">'+(r.name||'Anonyme')+'</div><div class="recipient-phone">'+r.phone+'</div></div>'+(r.requestId?'<span class="waiting-list-badge">Liste</span>':'')+'</div>').join('')} function dataTable(rows){return rows.map(r=>'<div class="data-row"><div class="data-label">'+r[0]+'</div><div class="data-value '+(r[2]||'')+'">'+r[1]+'</div></div>').join('')} function genCode(){let c='';for(let i=0;i<12;i++)c+=Math.floor(Math.random()*10);return c} function formatMSISDN(p){if(!p)return'';let m=p.replace(/[^\d]/g,'');if(m.startsWith('243')&&m.length===12)return m;if(m.startsWith('0')&&m.length===10)return'243'+m.slice(1);if(!m.startsWith('243')&&m.length===9)return'243'+m;return m} function highlight(json){return json.replace(/("(\\u[a-zA-Z0-9]{4}|\\[^u]|[^\\"])*"(\s*:)?|\b(true|false|null)\b|-?\d+(?:\.\d*)?(?:[eE][+\-]?\d+)?)/g,function(m){let c='number';if(/^"/.test(m)){if(/:$/.test(m)){c='key';m=m.slice(0,-1)+'</span>:';return'<span class="'+c+'">'+m}else c='string'}else if(/true|false/.test(m))c='boolean';return'<span class="'+c+'">'+m+'</span>'})} function cancelAndReturn(){sessionStorage.removeItem('paymentPreviewData');location.href='send.html'} function proceedWithPayment(){if(formData)sessionStorage.setItem('resumePaymentData',JSON.stringify(formData));alert('En mode r√©el, le paiement serait trait√©.\n\nRetour au formulaire.');location.href='send.html'} </script> </body> </html>