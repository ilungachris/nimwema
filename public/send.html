<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Envoyer un bon d'achat - Nimwema</title>
    <meta name="description" content="Envoyez un bon d'achat alimentaire via Nimwema">
    
    <!-- Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600;700;800&display=swap" rel="stylesheet">
    
    <!-- Styles -->
    <link rel="stylesheet" href="/css/styles.css">
    <link rel="stylesheet" href="/css/forms.css">
        <link rel="stylesheet" href="/css/send.css">
	<link rel="stylesheet" href="/css/flexpay-popup.css">
</head>
<body>
    <!-- Header -->
    <header class="header">
        <div class="header-top">
            <div class="language-selector">
                <button class="lang-btn active" data-lang="fr">FR</button>
                <button class="lang-btn" data-lang="ln">LN</button>
                <button class="lang-btn" data-lang="en">EN</button>
            </div>
            <button class="login-btn" onclick="window.location.href='/login.html'">
                Connexion
            </button>
        </div>
        
        <!-- Main Header: Logo + Menu -->
        <div class="header-main">
            <a href="/" class="logo">
                NIM<span class="w">W</span>EMA
            </a>
            <button class="hamburger" onclick="toggleMenu()">
                <span></span>
                <span></span>
                <span></span>
            </button>
        </div>
    </header>

    <!-- Main Content -->
    <main class="section">
        <div class="container container-narrow">
            <!-- Page Header -->
            <div class="page-header">
                <h1>Envoyer un bon d'achat</h1>
                <p class="text-small">
                    Choisissez le montant et envoyez un bon d'achat √† vos proches
                </p>
            </div>

            <!-- Send Form -->
            <form id="sendVoucherForm" class="form-card">
                <!-- Currency Selection -->
                <div class="form-section">
                    <h3 class="form-section-title">Devise</h3>
                    
                    <div class="currency-selector-group">
                        <button type="button" class="currency-btn active" data-currency="USD" onclick="selectCurrency('USD')">
                            <span class="currency-symbol">$</span>
                            <span class="currency-name">USD</span>
                        </button>
                        <button type="button" class="currency-btn" data-currency="CDF" onclick="selectCurrency('CDF')">
                            <span class="currency-symbol">FC</span>
                            <span class="currency-name">CDF</span>
                        </button>
                    </div>
                    
                    <div class="exchange-rate-display" id="exchangeRateDisplay">
                        <small>Taux de change:</small>
                        <strong id="exchangeRateText">1 USD = 2,200 CDF</strong>
                    </div>
                </div>

                <!-- Amount Selection -->
                <div class="form-section">
                    <h3 class="form-section-title">Montant</h3>
                    
                    <div class="amount-preset-grid" id="amountPresetGrid">
                        <!-- Preset buttons will be generated by JavaScript -->
                    </div>
                    
                    <div class="form-group">
                        <label for="customAmount" class="form-label">
                            Montant personnalis√©
                        </label>
                        <div class="amount-input-group">
                            <span class="amount-currency" id="amountCurrencySymbol">$</span>
                            <input 
                                type="number" 
                                id="customAmount" 
                                name="customAmount" 
                                class="form-input amount-input"
                                min="1"
                                step="1"
                                placeholder="0">
                            <span class="amount-equivalent" id="amountEquivalent"></span>
                        </div>
                        <div class="form-helper">
                            S√©lectionnez un montant pr√©d√©fini ou entrez un montant personnalis√©
                        </div>
                    </div>
                </div>

                <!-- Quantity Selection -->
                <div class="form-section">
                    <h3 class="form-section-title">Quantit√©</h3>
                    
                    <div class="form-group">
                        <label for="quantity" class="form-label">
                            <span>Nombre de bons</span>
                            <span class="required">*</span>
                        </label>
                        <input 
                            type="number" 
                            id="quantity" 
                            name="quantity" 
                            class="form-input" 
                            required
                            min="1"
                            max="50"
                            value="1"
                            onchange="updateTotalAmount()">
                        <div class="form-helper">
                            Nombre de bons d'achat √† cr√©er (maximum 50)
                        </div>
                    </div>
                    
                    <div class="total-amount-display">
                        <div class="total-label">Montant total:</div>
                        <div class="total-value" id="totalAmountDisplay">$0</div>
                    </div>
                </div>

                <!-- Recipients Selection -->
                <div class="form-section">
                    <h3 class="form-section-title">Destinataires</h3>
                    
                    <div class="radio-group">
                        <!-- Specific Recipients -->
                        <label class="radio-label">
                            <input 
                                type="radio" 
                                name="recipientType" 
                                value="specific"
                                checked
                                onchange="toggleRecipientFields()">
                            <span class="radio-custom"></span>
                            <span class="radio-text">
                                <strong>Destinataires sp√©cifiques</strong>
                                <small>Entrez les informations des destinataires</small>
                            </span>
                        </label>
                        
                        <!-- From Waiting List -->
                        <label class="radio-label">
                            <input 
                                type="radio" 
                                name="recipientType" 
                                value="waiting_list"
                                onchange="toggleRecipientFields()">
                            <span class="radio-custom"></span>
                            <span class="radio-text">
                                <strong>Depuis la liste d'attente</strong>
                                <small>Choisir des demandes en attente</small>
                            </span>
                        </label>
                    </div>
                    
                    <!-- Specific Recipients Section -->
                    <div id="specificRecipientsSection" style="margin-top: var(--space-lg);">
                        <div id="recipientsContainer">
                            <!-- Recipient fields will be added here -->
                        </div>
                        <button type="button" class="btn btn-secondary" onclick="addRecipientField()">
                            ‚ûï Ajouter un destinataire
                        </button>
                    </div>
                    
                    <!-- Waiting List Section -->
                    <div id="waitingListSection" class="hidden" style="margin-top: var(--space-lg);">
                        <div id="waitingListContainer">
                            <div class="loading-state">
                                <p>Chargement...</p>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Sender Information -->
                <div class="form-section">
                    <h3 class="form-section-title">Vos informations</h3>
                    
                    <div class="form-group">
                        <label for="senderName" class="form-label">
                            <span>Votre nom</span>
                            <span class="required">*</span>
                        </label>
                        <input 
                            type="text" 
                            id="senderName" 
                            name="senderName" 
                            class="form-input" 
                            required
                            placeholder="Votre nom complet">
                    </div>
                    
                    <div class="form-group">
                        <label for="senderPhone" class="form-label">
                            <span>Num√©ro de t√©l√©phone</span>
                            <span class="required">*</span>
                        </label>
                        <input 
                            type="tel" 
                            id="senderPhone" 
                            name="senderPhone" 
                            class="form-input" 
                            required
                            placeholder="+243 XXX XXX XXX">
                    </div>
                    
                    <div class="form-group">
                        <label for="message" class="form-label">
                            Message (optionnel)
                        </label>
                        <textarea 
                            id="message" 
                            name="message" 
                            class="form-textarea" 
                            rows="3"
                            maxlength="200"
                            placeholder="Ajoutez un message personnel..."></textarea>
                        <div class="form-helper">
                            <span id="messageCount">0</span>/200 caract√®res
                        </div>
                    </div>
                </div>

                <!-- Fee Information -->
                <div class="form-section">
                    <h3 class="form-section-title">Frais et paiement</h3>
                    
                    <div class="fee-breakdown">
                        <div class="fee-row">
                            <span>Sous-total:</span>
                            <span id="feeSubtotal">$0</span>
                        </div>
                        <div class="fee-row">
                            <span>Frais de service (3.5%):</span>
                            <span id="feeAmount">$0</span>
                        </div>
                        <div class="fee-row fee-total">
                            <span>Total √† payer:</span>
                            <span id="feeTotalAmount">$0</span>
                        </div>
                    </div>
                    
                    <div class="checkbox-group">
                        <label class="checkbox-label">
                            <input type="checkbox" id="coverFees" name="coverFees" onchange="updateFees()">
                            <span class="checkbox-custom"></span>
                            <span>Je prends en charge les frais (le destinataire recevra le montant complet)</span>
                        </label>
                    </div>
                </div>

                <!-- Payment Method Selection -->
                <div class="form-section">
                    <h3 class="form-section-title">M√©thode de paiement</h3>
                    
                    <div class="payment-methods-grid">
                        <label class="payment-method-card">
                            <input type="radio" name="paymentMethod" value="flexpay" checked>
                            <span class="payment-method-content">
                                <span class="payment-method-icon">üì±</span>
                                <span class="payment-method-name">Mobile Money</span>
                                <span class="payment-method-desc">Via FlexPay</span>
                            </span>
                        </label>
                        
                        <label class="payment-method-card">
                            <input type="radio" name="paymentMethod" value="flexpaycard">
                            <span class="payment-method-content">
                                <span class="payment-method-icon">üí≥</span>
                                <span class="payment-method-name">Carte bancaire</span>
                                <span class="payment-method-desc">Via FlexPay</span>
                            </span>
                        </label>
                        
                        <label class="payment-method-card">
                            <input type="radio" name="paymentMethod" value="cash">
                            <span class="payment-method-content">
                                <span class="payment-method-icon">üíµ</span>
                                <span class="payment-method-name">Cash / Western Union</span>
                                <span class="payment-method-desc">Paiement manuel</span>
                            </span>
                        </label>
                        
                        <label class="payment-method-card">
                            <input type="radio" name="paymentMethod" value="bank">
                            <span class="payment-method-content">
                                <span class="payment-method-icon">üè¶</span>
                                <span class="payment-method-name">Virement Bancaire</span>
                                <span class="payment-method-desc">Transfert bancaire</span>
                            </span>
                        </label>
                    </div>
                </div>

                <!-- Form Actions -->
                <div class="form-actions">
                    <button type="button" class="btn btn-secondary" onclick="window.history.back()">
                        Annuler
                    </button>
                    <button type="submit" class="btn btn-primary btn-large">
                        Proc√©der au paiement
                    </button>
                </div>
            </form>
        </div>
    </main>

    <!-- Footer -->
    <footer class="footer">
        <div class="container">
            <div class="footer-bottom">
                <p>&copy; 2024 Nimwema. Tous droits r√©serv√©s.</p>
            </div>
        </div>
    </footer>

    <!-- Scripts -->
    <script src="/js/send-voucher.js"></script>
    <script>
// Auto-fill phone number if ?recipientPhone[]=12345 is in the URL
document.addEventListener('DOMContentLoaded', () => {
  const params = new URLSearchParams(window.location.search);
  const phone = params.get('recipientPhone[]');

  if (phone) {
    // Fill the first (and only) phone input
    const phoneInput = document.querySelector('input[name="recipientPhone[]"]');
    if (phoneInput) {
      phoneInput.value = decodeURIComponent(phone);
    }

    // Optional: also focus the amount field so user can type immediately
    const amountInput = document.querySelector('input[name="amount"], input[name="montant"]');
    if (amountInput) amountInput.focus();
  }
});
</script>
</body>
</html>