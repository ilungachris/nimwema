<!DOCTYPE html>
<html>
<head>
    <title>Redirecting to FlexPay...</title>
    <style>
        body { font-family: Arial, sans-serif; background: #f5f5f5; display: flex; justify-content: center; align-items: center; height: 100vh; margin: 0; }
        .container { background: white; padding: 40px; border-radius: 10px; box-shadow: 0 4px 20px rgba(0,0,0,0.1); text-align: center; }
        .spinner { width: 50px; height: 50px; border: 4px solid #f3f3f3; border-top: 4px solid #8BC34A; border-radius: 50%; animation: spin 1s linear infinite; margin: 0 auto 20px; }
        @keyframes spin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }
        h3 { color: #333; margin-bottom: 20px; }
        p { color: #666; }
    </style>
<script src="https://sites.super.myninja.ai/_assets/ninja-daytona-script.js"></script>
</head>
<body>
    <div class="container">
        <div class="spinner"></div>
        <h3>Connecting to FlexPay...</h3>
        <p>Please wait while we redirect you to the payment page.</p>
        
        <!-- FLEXPAY NEEDS JSON - We'll use fetch API -->
        <script>
            // Get parameters from URL
            const urlParams = new URLSearchParams(window.location.search);
            const orderId = urlParams.get('order');
            const amount = urlParams.get('amount');
            
            // Create JSON data for FlexPay
            const paymentData = {
                order: orderId,
                amount: amount,
                merchant: "CPOSSIBLE",
                token: "Bearer eyJ0eXAiOiJKV1QiLCJhbGciOiJIUzI1NiJ9.eyJzdWIiOiJzNnEyTEhrNWppRzlmekJuWWY3TyIsInJvbGVzIjpbIk1FUkNIQU5UIl0sImlzcyI6Ii9sb2dpbiIsImV4cCI6MTczNTY4NjAwMH0.uuJQqBkwmJADSUpgip9t0HngUofyAdWPTeVnSfN288A"
            };
            
            // Send POST request with JSON content-type
            fetch('https://backend.flexpay.cd/api/rest/v1/paymentService', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                    'Authorization': 'Bearer eyJ0eXAiOiJKV1QiLCJhbGciOiJIUzI1NiJ9.eyJzdWIiOiJzNnEyTEhrNWppRzlmekJuWWY3TyIsInJvbGVzIjpbIk1FUkNIQU5UIl0sImlzcyI6Ii9sb2dpbiIsImV4cCI6MTczNTY4NjAwMH0.uuJQqBkwmJADSUpgip9t0HngUofyAdWPTeVnSfN288A'
                },
                body: JSON.stringify(paymentData)
            })
            .then(response => {
                if (response.ok) {
                    // If successful, redirect to their payment page
                    return response.text();
                } else {
                    throw new Error('Payment initiation failed');
                }
            })
            .then(paymentUrl => {
                // Redirect to the actual payment URL
                if (paymentUrl && paymentUrl.startsWith('http')) {
                    window.location.href = paymentUrl;
                } else {
                    document.body.innerHTML = `
                        <div style="font-family: Arial, sans-serif; text-align: center; padding: 50px;">
                            <h3>Payment Response</h3>
                            <pre>${paymentUrl}</pre>
                            <button onclick="window.close()">Close</button>
                        </div>
                    `;
                }
            })
            .catch(error => {
                document.body.innerHTML = `
                    <div style="font-family: Arial, sans-serif; text-align: center; padding: 50px; color: red;">
                        <h3>Payment Error</h3>
                        <p>${error.message}</p>
                        <button onclick="history.back()">Go Back</button>
                    </div>
                `;
            });
        </script>
    </div>

    <script>
        // Get parameters from URL
        const urlParams = new URLSearchParams(window.location.search);
        const orderId = urlParams.get('order');
        const amount = urlParams.get('amount');
        
        // Set form values
        document.getElementById('flexpayOrder').value = orderId;
        document.getElementById('flexpayAmount').value = amount;
        
        // Auto-submit form after 2 seconds
        setTimeout(() => {
            document.getElementById('flexpayForm').submit();
        }, 2000);
    </script>
</body>
</html>