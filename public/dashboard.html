<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Mon Tableau de Bord - Nimwema</title>
    <meta name="description" content="Gérez vos demandes de bons d'achat et vos expéditeurs">
    
<link rel="preconnect" href="https://fonts.googleapis.com">
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600;700;800&display=swap" rel="stylesheet">

<link rel="stylesheet" href="/css/styles.css">
<link rel="stylesheet" href="/css/forms.css">
<link rel="stylesheet" href="/css/dashboard.css"></head>
<body>
    <header class="header">
        <div class="header-top">
            <div class="language-selector">
                <button class="lang-btn active" data-lang="fr">FR</button>
                <button class="lang-btn" data-lang="ln">LN</button>
                <button class="lang-btn" data-lang="en">EN</button>
            </div>
            <div class="user-menu">
                <span class="user-name" id="userName">Utilisateur</span>
                <button class="btn-logout" onclick="logout()" data-i18n="logout">Déconnexion</button>
            </div>
        </div>
        
    <div class="header-main">
        <a href="/" class="logo">
            NIM<span class="w">W</span>EMA
        </a>
        <button class="hamburger" onclick="toggleMenu()">
            <span></span>
            <span></span>
            <span></span>
        </button>
    </div>
</header>

<main class="dashboard-container">
    <aside class="dashboard-sidebar">
        <nav class="dashboard-nav">
            <a href="#pending-orders" class="nav-item active" onclick="showSection('pending-orders')" data-i18n="pending_orders">
                <span class="nav-icon"></span>
                <span class="nav-text">Commandes en attente</span>
            </a>
            <a href="#requests" class="nav-item" onclick="showSection('requests')" data-i18n="my_requests">
                <span class="nav-icon"></span>
                <span class="nav-text">Mes Demandes</span>
            </a>
            <a href="#senders" class="nav-item" onclick="showSection('senders')" data-i18n="my_senders">
                <span class="nav-icon"></span>
                <span class="nav-text">Mes Expéditeurs</span>
            </a>
            <a href="#new-request" class="nav-item nav-item-primary" onclick="window.location.href='/request.html'" data-i18n="new_request">
                <span class="nav-icon"></span>
                <span class="nav-text">Nouvelle Demande</span>
            </a>
        </nav>
    </aside>

    <div class="dashboard-content">
        <section id="pendingOrdersSection" class="dashboard-section active">
            <div class="section-header">
                <div>
                    <h1>Mes Commandes en Attente</h1>
                    <p class="text-small">Commandes en attente de validation de paiement</p>
                </div>
                <button class="btn btn-secondary" onclick="loadPendingOrders()"> Actualiser</button>
            </div>
            
            <div id="pendingOrdersList">
                <div class="loading-state">
                    <p>Chargement...</p>
                </div>
            </div>
        </section>

        <section id="requestsSection" class="dashboard-section">
            <div class="section-header">
                <div>
                    <h1 data-i18n="my_requests">Mes Demandes</h1>
                    <p class="text-small" data-i18n="requests_subtitle">
                        Gérez toutes vos demandes de bons d'achat
                    </p>
                </div>
                <button class="btn btn-primary" onclick="window.location.href='/request.html'" data-i18n="new_request">
                     Nouvelle Demande
                </button>
            </div>

            <div class="filters-bar">
                <div class="filter-group">
                    <label data-i18n="filter_by_status">Filtrer par statut:</label>
                    <select id="statusFilter" class="form-select" onchange="filterRequests()">
                        <option value="all" data-i18n="all_statuses">Tous</option>
                        <option value="pending" data-i18n="pending">En attente</option>
                        <option value="fulfilled" data-i18n="fulfilled">Satisfait</option>
                        <option value="expired" data-i18n="expired">Expiré</option>
                    </select>
                </div>
                
                <div class="filter-group">
                    <label data-i18n="filter_by_type">Filtrer par type:</label>
                    <select id="typeFilter" class="form-select" onchange="filterRequests()">
                        <option value="all" data-i18n="all_types">Tous</option>
                        <option value="known_sender" data-i18n="known_sender">Expéditeur connu</option>
                        <option value="waiting_list" data-i18n="waiting_list">Liste d'attente</option>
                    </select>
                </div>
                
                <div class="filter-group">
                    <label data-i18n="sort_by">Trier par:</label>
                    <select id="sortBy" class="form-select" onchange="sortRequests()">
                        <option value="date_desc" data-i18n="newest_first">Plus récent</option>
                        <option value="date_asc" data-i18n="oldest_first">Plus ancien</option>
                        <option value="status" data-i18n="status">Statut</option>
                    </select>
                </div>
            </div>

            <div id="requestsList" class="requests-list">
                <div class="loading-state">
                    <p data-i18n="loading">Chargement...</p>
                </div>
            </div>
        </section>

        <section id="sendersSection" class="dashboard-section">
            <div class="section-header">
                <div>
                    <h1 data-i18n="my_senders">Mes Expéditeurs</h1>
                    <p class="text-small" data-i18n="senders_subtitle">
                        Gérez vos contacts expéditeurs favoris
                    </p>
                </div>
                <button class="btn btn-primary" onclick="showAddSenderModal()" data-i18n="add_sender">
                     Ajouter un expéditeur
                </button>
            </div>

            <div id="sendersList" class="senders-grid">
                <div class="loading-state">
                    <p data-i18n="loading">Chargement...</p>
                </div>
            </div>
        </section>
    </div>
</main>

<div id="requestModal" class="modal">
    <div class="modal-content">
        <div class="modal-header">
            <h2 data-i18n="request_details">Détails de la demande</h2>
            <button class="modal-close" onclick="closeModal('requestModal')">&times;</button>
        </div>
        <div class="modal-body" id="requestModalBody"></div>
        <div class="modal-footer">
            <button class="btn btn-secondary" onclick="closeModal('requestModal')" data-i18n="close">Fermer</button>
        </div>
    </div>
</div>

<div id="senderModal" class="modal">
    <div class="modal-content">
        <div class="modal-header">
            <h2 id="senderModalTitle" data-i18n="add_sender">Ajouter un expéditeur</h2>
            <button class="modal-close" onclick="closeModal('senderModal')">&times;</button>
        </div>
        <div class="modal-body">
            <form id="senderForm" onsubmit="saveSender(event)">
                <input type="hidden" id="senderId" name="senderId">
                
                <div class="form-group">
                    <label for="senderFormName" class="form-label">
                        <span data-i18n="sender_name">Nom</span>
                        <span class="required">*</span>
                    </label>
                    <input type="text" id="senderFormName" name="name" class="form-input" required
                        data-i18n-placeholder="sender_name_placeholder" placeholder="Nom de l'expéditeur">
                </div>
                
                <div class="form-group">
                    <label for="senderFormPhone" class="form-label">
                        <span data-i18n="sender_phone">Numéro de téléphone</span>
                        <span class="required">*</span>
                    </label>
                    <input type="tel" id="senderFormPhone" name="phone" class="form-input" required
                        data-i18n-placeholder="phone_placeholder" placeholder="+243 XXX XXX XXX">
                </div>
                
                <div class="form-group">
                    <label for="senderFormRelation" class="form-label">
                        <span data-i18n="relation">Relation</span>
                    </label>
                    <input type="text" id="senderFormRelation" name="relation" class="form-input"
                        data-i18n-placeholder="relation_placeholder" placeholder="Ex: Famille, Ami, Collègue">
                </div>
                
                <div class="form-actions">
                    <button type="button" class="btn btn-secondary" onclick="closeModal('senderModal')" data-i18n="cancel">Annuler</button>
                    <button type="submit" class="btn btn-primary" data-i18n="save">Enregistrer</button>
                </div>
            </form>
        </div>
    </div>
</div>

<div id="deleteModal" class="modal">
    <div class="modal-content modal-small">
        <div class="modal-header">
            <h2 data-i18n="confirm_delete">Confirmer la suppression</h2>
            <button class="modal-close" onclick="closeModal('deleteModal')">&times;</button>
        </div>
        <div class="modal-body">
            <p id="deleteMessage" data-i18n="delete_confirmation">Êtes-vous sûr de vouloir supprimer cet élément ?</p>
        </div>
        <div class="modal-footer">
            <button class="btn btn-secondary" onclick="closeModal('deleteModal')" data-i18n="cancel">Annuler</button>
            <button class="btn btn-primary" style="background: var(--error);" onclick="confirmDelete()" data-i18n="delete">Supprimer</button>
        </div>
    </div>
</div>

<footer class="footer">
    <div class="container">
        <div class="footer-bottom">
            <p>&copy; 2024 Nimwema. <span data-i18n="all_rights">Tous droits réservés.</span></p>
        </div>
    </div>
</footer>

<script src="/js/i18n.js"></script>
<script src="/js/main.js"></script>
<script>
    
window.addEventListener('DOMContentLoaded', function () {
    const user = localStorage.getItem('nimwema_user');

    if (!user) {
        window.location.href = 'login.html';
        return;
    }

    const userData = JSON.parse(user);

 /*   if (userData.role !== 'merchant') {
        alert('Accès non autorisé');
        window.location.href = '/';
        return;
    }*/
});
 

function renderOrders(orders) {
    const container = document.getElementById('pendingOrdersList');

    if (!orders || orders.length === 0) {
        container.innerHTML = '<p class="empty-message">Aucune commande en attente.</p>';
        return;
    }

    container.innerHTML = orders.map(order => `
        <div class="order-card">
            <div class="order-header">
                <h3>Commande #${escapeHTML(order.id)}</h3>
                <p>${formatDate(order.createdAt)}</p>
            </div>

            <div class="order-details">
                <div class="detail-row">
                    <span>Montant:</span>
                    <strong>${formatCurrency(order.amount, order.currency)}</strong>
                </div>

                <div class="detail-row">
                    <span>Quantité:</span>
                    <strong>${order.quantity} bon(s)</strong>
                </div>

                <div class="detail-row">
                    <span>Méthode:</span>
                    <strong>${getPaymentMethodLabel(order.paymentMethod)}</strong>
                </div>
            </div>
        </div>
    `).join('');
}





    const CONFIG = {
        API_BASE: '/api',
        STORAGE_KEYS: {
            USER: 'nimwema_user',
            TOKEN: 'nimwema_token'
        },
        REFRESH_INTERVAL: 30000
    };
    
    let refreshInterval = null;
    
let currentUser = null;
    let allRequests = [];


function checkAuth() {
    const userStr = localStorage.getItem(CONFIG.STORAGE_KEYS.USER);
    const token   = localStorage.getItem(CONFIG.STORAGE_KEYS.TOKEN); // may be null

    if (!userStr) {
        window.location.href = '/login.html';
        return false;
    }

    try {
        currentUser = JSON.parse(userStr);
        const name = currentUser.name || currentUser.email || 'Utilisateur';
        document.getElementById('userName').textContent = name;
        // do NOT fail if token is missing
        return true;
    } catch (error) {
        console.error('Error parsing user data:', error);
        logout();
        return false;
    }
}

    

    ////////
    function getAuthHeaders() {
        const token = localStorage.getItem(CONFIG.STORAGE_KEYS.TOKEN);
        return {
            'Content-Type': 'application/json',
            'Authorization': `Bearer ${token}`
        };
    }
    
    async function logout() {
        try {
            await fetch(`${CONFIG.API_BASE}/auth/logout`, {
                method: 'POST',
                headers: getAuthHeaders(),
                credentials: 'include'
            });
        } catch (error) {
            console.error('Logout error:', error);
        } finally {
            localStorage.removeItem(CONFIG.STORAGE_KEYS.USER);
            localStorage.removeItem(CONFIG.STORAGE_KEYS.TOKEN);
            window.location.href = '/login.html';
        }
    }
    
    
function showSection(sectionName) {
    console.log('[TRACE] showSection:', sectionName);

    // Ensure we have a user object if possible
    if (!currentUser) {
        console.log('[TRACE] No user – check auth (once)');
        if (!checkAuth()) {
            return;
        }
    }

    // Update active item in sidebar
    const navItems = document.querySelectorAll('.dashboard-nav .nav-item');
    navItems.forEach(item => item.classList.remove('active'));

    const map = {
        'pending-orders': '#pending-orders',
        'requests': '#requests',
        'senders': '#senders'
    };

    // If called from a click, event.currentTarget will be set
    let activeLink = null;
    const evt = window.event;
    if (evt && evt.currentTarget && evt.currentTarget.classList && evt.currentTarget.classList.contains('nav-item')) {
        activeLink = evt.currentTarget;
    } else {
        const selector = map[sectionName];
        if (selector) {
            activeLink = document.querySelector(`.dashboard-nav a[href="${selector}"]`);
        }
    }
    if (activeLink) {
        activeLink.classList.add('active');
    }

    // Switch visible section
    document.querySelectorAll('.dashboard-section').forEach(section => {
        section.classList.remove('active');
    });

    let targetSection = null;
    switch (sectionName) {
        case 'pending-orders':
            targetSection = document.getElementById('pendingOrdersSection');
            if (typeof loadPendingOrders === 'function') {
                loadPendingOrders();
            }
            break;
        case 'requests':
            targetSection = document.getElementById('requestsSection');
            if (typeof loadRequests === 'function') {
                loadRequests();
            }
            break;
        case 'senders':
            targetSection = document.getElementById('sendersSection');
            if (typeof loadSenders === 'function') {
                loadSenders();
            }
            break;
        default:
            break;
    }

    if (targetSection) {
        targetSection.classList.add('active');
    }
}

async function loadPendingOrders() {
        const container = document.getElementById('pendingOrdersList');
        
        try {
                    const response = await fetch(`${CONFIG.API_BASE}/orders/my-pending`, {

                headers: getAuthHeaders(),
                credentials: 'include'
            });
            
            if (!response.ok) {
                throw new Error(`HTTP ${response.status}`);
            }
            
            const data = await response.json();


                    if (!response.ok || !data.success) {
            console.error('Error loading pending orders:', data);
            // show some error message if you want
            return;
        }
            
            if (data.success && data.orders && data.orders.length > 0) {
                container.innerHTML = data.orders.map(order => `
                    <div class="order-card">
                        <div class="order-header">
                            <div>
                                <h3>Commande #${escapeHTML(order.id)}</h3>
                                <p class="text-small">${formatDate(order.createdAt)}</p>
                            </div>
                            <span class="status-badge status-pending">En attente</span>
                        </div>
                        <div class="order-details">
                            <div class="detail-row">
                                <span>Montant:</span>
                                <strong>${formatCurrency(order.amount, order.currency)}</strong>
                            </div>
                            <div class="detail-row">
                                <span>Quantité:</span>
                                <strong>${order.quantity} bon(s)</strong>
                            </div>
                            <div class="detail-row">
                                <span>Méthode:</span>
                                <strong>${getPaymentMethodLabel(order.paymentMethod)}</strong>
                            </div>
                        </div>
                        <div class="order-actions">
                            <button class="btn btn-secondary btn-sm" onclick="viewOrderInstructions('${order.id}')">
                                Voir instructions
                            </button>
                            <button class="btn btn-danger btn-sm" onclick="confirmDeleteOrder('${order.id}')">
                                Annuler
                            </button>
                        </div>
                    </div>
                `).join('');
            } else {
                container.innerHTML = `
                    <div class="empty-state">
                        <p>Aucune commande en attente</p>
                        <button class="btn btn-primary" onclick="window.location.href='/send.html'">
                            Envoyer un bon d'achat
                        </button>
                    </div>
                `;
            }
        } catch (error) {
            console.error('Error loading pending orders:', error);
                    

            container.innerHTML = `
                <div class="error-state">
                    <p>Erreur lors du chargement des commandes</p>
                    <button class="btn btn-secondary" onclick="loadPendingOrders()">Réessayer</button>
                </div>
            `;
        }
    }
    
    function escapeHTML(str) {
        const div = document.createElement('div');
        div.textContent = str;
        return div.innerHTML;
    }
    
    function formatCurrency(amount, currency = 'USD') {
        return new Intl.NumberFormat('fr-FR', {
            style: 'currency',
            currency: currency
        }).format(amount);
    }
    
    function formatDate(dateString) {
        return new Intl.DateTimeFormat('fr-FR', {
            year: 'numeric',
            month: 'long',
            day: 'numeric',
            hour: '2-digit',
            minute: '2-digit'
        }).format(new Date(dateString));
    }
    
    function getPaymentMethodLabel(method) {
        const labels = {
            'flexpay': 'Mobile Money',
            'flexpaycard': 'Carte bancaire',
            'cash': 'Cash/Western Union',
            'bank': 'Virement bancaire'
        };
        return labels[method] || method;
    }
    
    function viewOrderInstructions(orderId) {
        window.location.href = `/payment-instructions.html?order=${encodeURIComponent(orderId)}`;
    }
    
    function confirmDeleteOrder(orderId) {
        if (confirm('Êtes-vous sûr de vouloir annuler cette commande ?')) {
            deleteOrder(orderId);
        }
    }
    
    async function deleteOrder(orderId) {
        try {
            const response = await fetch(`${CONFIG.API_BASE}/user/orders/${encodeURIComponent(orderId)}`, {
                method: 'DELETE',
                headers: getAuthHeaders(),
                credentials: 'include'
            });
            
            const data = await response.json();
            
            if (data.success) {
                alert('Commande annulée avec succès');
                loadPendingOrders();
            } else {
                throw new Error(data.message || 'Erreur lors de l\'annulation');
            }
        } catch (error) {
            console.error('Error deleting order:', error);
            alert('Erreur lors de l\'annulation de la commande');
        }
    }
    
    
function loadRequests() {
    const container = document.getElementById('requestsList');
    if (!container) return;

    container.innerHTML = `
        <div class="loading-state">
            <p data-i18n="loading">Chargement...</p>
        </div>
    `;

    function loadLocalRequests() {
        const STORAGE_KEY = 'nimwema_requests';
        try {
            const raw = localStorage.getItem(STORAGE_KEY);
            if (!raw) return [];
            const items = JSON.parse(raw) || [];
            return items
                .filter(it => it && it.id)
                .map(it => ({
                    id: it.id,
                    fullName: it.name || '',
                    firstName: null,
                    lastName: null,
                    phone: it.phone,
                    message: '',
                    requestType: 'waiting_list',
                    senderName: null,
                    senderPhone: null,
                    status: it.status || 'pending',
                    created_at: it.createdAt ? new Date(it.createdAt).toISOString() : new Date().toISOString(),
                    expires_at: it.expiresAt ? new Date(it.expiresAt).toISOString() : null,
                    source: 'local'
                }));
        } catch (e) {
            console.warn('Error parsing local requests:', e);
            return [];
        }
    }

async function loadRemoteRequests() {
    try {
        const params = new URLSearchParams();

        // Scope strictly to current user: prefer phone, fallback to userId
        if (currentUser && currentUser.phone) {
            params.append('phone', currentUser.phone);
        } else if (currentUser && currentUser.id) {
            params.append('userId', currentUser.id);
        }

        // Safety: never call /api/requests without a filter
        const qs = params.toString();
        if (!qs) {
            console.warn('loadRemoteRequests: no phone or userId on currentUser, skipping remote load');
            return [];
        }

        const url = `${CONFIG.API_BASE}/requests?${qs}`;
        const resp = await fetch(url, {
            method: 'GET',
            headers: { 'Content-Type': 'application/json' },
            credentials: 'include'
        });

        if (!resp.ok) {
            console.warn('loadRequests remote failed with status', resp.status);
            return [];
        }

        const data = await resp.json();
        if (!Array.isArray(data)) {
            console.warn('loadRequests remote returned non-array', data);
            return [];
        }

        // Ensure consistent shape
        return data.map(req => ({
            ...req,
            source: 'remote'
        }));
    } catch (e) {
        console.error('Error loading remote requests:', e);
        return [];
    }
}

//////
    (async () => {
        const [remote, local] = await Promise.all([
            loadRemoteRequests(),
            loadLocalRequests()
        ]);

        const byId = new Map();
        remote.forEach(r => {
            if (!r || r.id == null) return;
            byId.set(String(r.id), r);
        });
        local.forEach(r => {
            if (!r || r.id == null) return;
            const key = String(r.id);
            if (!byId.has(key)) {
                byId.set(key, r);
            }
        });

        allRequests = Array.from(byId.values());
        applyRequestFiltersAndRender();
    })();
}

function applyRequestFiltersAndRender() {
    const container = document.getElementById('requestsList');
    if (!container) return;

    if (!allRequests || allRequests.length === 0) {
        container.innerHTML = `
            <div class="empty-state">
                <p data-i18n="no_requests">Aucune demande pour l'instant</p>
            </div>
        `;
        return;
    }

    const statusFilterEl = document.getElementById('statusFilter');
    const typeFilterEl = document.getElementById('typeFilter');
    const sortSelectEl = document.getElementById('sortSelect');

    const status = statusFilterEl ? statusFilterEl.value : 'all';
    const type = typeFilterEl ? typeFilterEl.value : 'all';
    const sortMode = sortSelectEl ? sortSelectEl.value : 'date_desc';

    let items = allRequests.slice();

    if (status && status !== 'all') {
        items = items.filter(r => (r.status || 'pending') === status);
    }

    if (type && type !== 'all') {
        items = items.filter(r => (r.requestType || r.type || 'waiting_list') === type);
    }

    items.sort((a, b) => {
        const da = new Date(a.created_at || a.createdAt || 0).getTime();
        const db = new Date(b.created_at || b.createdAt || 0).getTime();
        if (sortMode === 'date_asc') return da - db;
        if (sortMode === 'date_desc') return db - da;
        if (sortMode === 'status') {
            return String(a.status || '').localeCompare(String(b.status || ''));
        }
        return db - da;
    });

    container.innerHTML = items.map(req => {
        const statusVal = req.status || 'pending';
        let statusClass = 'status-pending';
        let statusLabel = 'En attente';
        if (statusVal === 'fulfilled' || statusVal === 'received') {
            statusClass = 'status-success';
            statusLabel = 'Reçue';
        } else if (statusVal === 'expired') {
            statusClass = 'status-expired';
            statusLabel = 'Expirée';
        } else if (statusVal === 'cancelled' || statusVal === 'canceled') {
            statusClass = 'status-failed';
            statusLabel = 'Annulée';
        }

        const typeVal = req.requestType || req.type || 'waiting_list';
        const typeLabel = typeVal === 'known_sender' ? 'Expéditeur connu' : 'Liste d\'attente';

        const created = req.created_at || req.createdAt;
        
        const expires = req.expires_at || req.expiresAt;

        const fullName = req.fullName || (
            req.firstName ? (req.firstName + ' ' + (req.lastName || '')) : 'Demande'
        );

        return `
            <div class="order-card request-card">
                <div class="order-header">
                    <div>
                        <h3>${escapeHTML(fullName)}</h3>
                        <p class="text-small">${created ? formatDate(created) : ''}</p>
                    </div>
                    <span class="status-badge ${statusClass}">${statusLabel}</span>
                </div>
                <div class="order-details">
                    <div class="detail-row">
                        <span>Tél. bénéficiaire:</span>
                        <strong>${escapeHTML(req.phone || '')}</strong>
                    </div>
                    <div class="detail-row">
                        <span>Type:</span>
                        <strong>${typeLabel}</strong>
                    </div>
                    ${expires ? `
                    <div class="detail-row">
                        <span>Expire le:</span>
                        <strong>${formatDate(expires)}</strong>
                    </div>` : ''}
                    ${req.message ? `
                    <div class="detail-row">
                        <span>Message:</span>
                        <span>${escapeHTML(req.message)}</span>
                    </div>` : ''}
                </div>
            </div>
        `;
    }).join('');
}

function filterRequests() {
    applyRequestFiltersAndRender();
}

function sortRequests() {
    applyRequestFiltersAndRender();
}

function loadSenders() {
        document.getElementById('sendersList').innerHTML = `
            <div class="empty-state">
                <p>Fonction en développement</p>
            </div>
        `;
    }
    
    function closeModal(modalId) {
        document.getElementById(modalId).style.display = 'none';
    }
    
    function showAddSenderModal() {
        document.getElementById('senderModal').style.display = 'block';
    }
    
    function saveSender(event) {
        event.preventDefault();
        alert('Fonction en développement');
    }
    
    function confirmDelete() {
        alert('Fonction en développement');
    }
    
    function toggleMenu() {
        document.querySelector('.dashboard-sidebar').classList.toggle('mobile-open');
    }
    
    
document.addEventListener('DOMContentLoaded', function() {
    console.log('[TRACE] DOMLoaded – check auth once');
    if (checkAuth()) {
        if (currentUser && currentUser.role === 'requester') {
            // Requester: show their requests (including session/local ones)
            showSection('requests');
        } else {
            // Sender or other: keep current behaviour on pending orders
            showSection('pending-orders');
            refreshInterval = setInterval(function() {
                if (typeof loadPendingOrders === 'function') {
                    loadPendingOrders();
                }
            }, CONFIG.REFRESH_INTERVAL);
        }
    }
});
    
    window.addEventListener('beforeunload', function() {
        if (refreshInterval) {
            clearInterval(refreshInterval);
        }
    });
</script></body>
</html>

